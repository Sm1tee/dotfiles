(()=>{"use strict";var e={5038:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ChromeMessageType=void 0,(n=t.ChromeMessageType||(t.ChromeMessageType={}))[n.DOWNLOAD_TRACK=0]="DOWNLOAD_TRACK",n[n.DOWNLOAD_ALBUM=1]="DOWNLOAD_ALBUM",n[n.DOWNLOAD_PLAYLIST=2]="DOWNLOAD_PLAYLIST",n[n.DOWNLOAD_ARTIST=3]="DOWNLOAD_ARTIST",n[n.ADD_DOWNLOAD_LISTENER=4]="ADD_DOWNLOAD_LISTENER",n[n.ADD_ERROR_LISTENER=5]="ADD_ERROR_LISTENER",n[n.DOWNLOAD_EVENT=6]="DOWNLOAD_EVENT",n[n.DOWNLOAD_ERROR_EVENT=7]="DOWNLOAD_ERROR_EVENT",n[n.ERROR_EVENT=8]="ERROR_EVENT",n[n.LIST_DOWNLOAD_ITEMS=9]="LIST_DOWNLOAD_ITEMS",n[n.INTERRUPT_DOWNLOAD=10]="INTERRUPT_DOWNLOAD"}},t={};function n(o){var c=t[o];if(void 0!==c)return c.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}(()=>{const e=n(5038),t=1e3,o=(()=>{const e=window.location.host.split(".");return e[e.length-1]})(),c=chrome.runtime.connect({name:o});function s(e,t,n){let o;return function(){const c=this,s=arguments,r=function(){o=null,n||e.apply(c,s)},a=n&&!o;clearTimeout(o),o=setTimeout(r,t),a&&e.apply(c,s)}}const r=t=>{const n={type:e.ChromeMessageType.DOWNLOAD_TRACK,trackId:+t};c.postMessage(n)},a=t=>{const n={type:e.ChromeMessageType.DOWNLOAD_ALBUM,albumId:+t};c.postMessage(n)},d=e=>{const t=e.querySelector(".d-track__name a");return t?+t.getAttribute("href").split("/")[4]:null},i=()=>{const e=document.querySelector(".centerblock");e&&e.querySelectorAll(".d-track").forEach((e=>{if(e.querySelector(".YMD-icon"))return;const t=e.querySelector(".d-track__actions"),n=document.createElement("span"),o=d(e);o&&(n.classList.add("YMD-icon","page__track_YMD-icon"),document.body.classList.contains("theme-black")?n.classList.add("YMD-icon-dark"):n.classList.add("YMD-icon-light"),n.addEventListener("click",(()=>{r(o)})),n.title="Загрузить",t.prepend(n))}))};!function(){const e=document.body;new MutationObserver((()=>{const e=document.querySelectorAll(".YMD-icon"),t=document.body.classList.contains("theme-black");e.forEach((e=>{t?(e.classList.remove("YMD-icon-light"),e.classList.add("YMD-icon-dark")):(e.classList.remove("YMD-icon-dark"),e.classList.add("YMD-icon-light"))}))})).observe(e,{attributes:!0,childList:!1,subtree:!1})}(),function(){const e=document.body;new MutationObserver(((e,n)=>{document.querySelector(".player-controls__seq-controls")&&document.querySelector(".player-controls__speed-controls")&&((()=>{const e=document.querySelector(".player-controls__seq-controls"),n=document.querySelector(".player-controls__speed-controls"),o=document.createElement("div"),c=document.createElement("span");c.classList.add("YMD-icon","player__YMD_icon"),o.classList.add("player-controls__btn","deco-player-controls__button","player-controls__btn_download"),o.title="Загрузить текущий трек",document.body.classList.contains("theme-black")?c.classList.add("YMD-icon-dark"):c.classList.add("YMD-icon-light"),o.appendChild(c),e.appendChild(o),n.appendChild(o.cloneNode(!0)),e.querySelector(".player-controls__btn_download span").addEventListener("click",s((()=>{const e=document.querySelector(".player-controls .track__name a").getAttribute("href");r(+e.split("/")[4])}),t)),n.querySelector(".player-controls__btn_download span").addEventListener("click",s((()=>{const e=document.querySelector(".player-controls .track__name a").getAttribute("href");r(+e.split("/")[4])}),t))})(),n.disconnect())})).observe(e,{attributes:!1,childList:!0,subtree:!0})}(),function(){const n=document.querySelector(".sidebar");new MutationObserver((()=>{(()=>{const e=document.querySelectorAll(".sidebar-cont");return!!e.length&&e[e.length-1].querySelectorAll(".sidebar__tracks .d-track").length>0})()?(()=>{const n=document.querySelectorAll(".sidebar-cont"),o=n[n.length-1],i=o.querySelector(".sidebar__controls");if(o.querySelectorAll(".sidebar__tracks .d-track").forEach((e=>{if(e.querySelector(".YMD-icon"))return;const t=e.querySelector(".d-track__actions"),n=document.createElement("span"),o=d(e);o&&(n.classList.add("YMD-icon","sidebar__track_YMD-icon"),document.body.classList.contains("theme-black")?n.classList.add("YMD-icon-dark"):n.classList.add("YMD-icon-light"),n.addEventListener("click",(()=>{r(o)})),n.title="Загрузить",t.prepend(n))})),i.querySelector(".sidebar__YMD-icon"))return;if(o.querySelector(".sidebar-artist"))return;const l=document.createElement("button"),u=document.createElement("span"),_=document.createElement("span"),p=document.createElement("span");l.classList.add("d-button","deco-button","deco-button-transparent","d-button_rounded","d-button_size_L","d-button_w-icon","d-button_w-icon-centered","sidebar__YMD-button"),u.classList.add("d-button-inner","deco-button-stylable"),_.classList.add("d-button__inner"),p.classList.add("YMD-icon","sidebar__YMD-icon"),l.title="Загрузить",document.body.classList.contains("theme-black")?p.classList.add("YMD-icon-dark"):p.classList.add("YMD-icon-light"),_.append(p),u.append(_),l.append(u),l.addEventListener("click",s((()=>{const t=o.querySelector(".sidebar__title a");if(!t)return;const n=t.getAttribute("href").split("/");if(5===n.length){if(o.querySelector(".sidebar-track "))return void r(n[4]);((t,n)=>{const o={type:e.ChromeMessageType.DOWNLOAD_PLAYLIST,owner:t,kind:+n};c.postMessage(o)})(n[2],n[4])}else 3===n.length&&a(n[2])}),t)),i.append(l)})():(()=>{const e=document.querySelectorAll(".sidebar-cont");if(!e.length)return;const t=e[e.length-1].querySelector(".sidebar__YMD-button");t&&t.parentNode.removeChild(t)})()})).observe(n,{attributes:!1,childList:!0,subtree:!0})}(),function(){const n=document.body;new MutationObserver((()=>{const n=document.querySelector(".page-artist");if(n)return void(n=>{i();const o=n.querySelector(".d-generic-page-head__main-actions");if(o.querySelector(".YMD-icon"))return;const r=document.createElement("button"),a=document.createElement("span"),d=document.createElement("span"),l=document.createElement("span");r.classList.add("d-button","deco-button","deco-button-transparent","d-button_rounded","d-button_size_L","d-button_w-icon","d-button_w-icon-centered","page__YMD-button"),a.classList.add("d-button-inner","deco-button-stylable"),d.classList.add("d-button__inner"),l.classList.add("YMD-icon","page__YMD-icon"),r.title="Загрузить",document.body.classList.contains("theme-black")?l.classList.add("YMD-icon-dark"):l.classList.add("YMD-icon-light"),d.append(l),a.append(d),r.append(a),r.addEventListener("click",s((()=>{(t=>{const n={type:e.ChromeMessageType.DOWNLOAD_ARTIST,artistId:+t};c.postMessage(n)})(window.location.pathname.split("/")[2])}),t)),o.append(r)})(n);const o=document.querySelector(".page-album");o?(e=>{i();const n=e.querySelector(".d-generic-page-head__main-actions");if(n.querySelector(".YMD-icon"))return;const o=document.createElement("button"),c=document.createElement("span"),r=document.createElement("span"),d=document.createElement("span");o.classList.add("d-button","deco-button","deco-button-transparent","d-button_rounded","d-button_size_L","d-button_w-icon","d-button_w-icon-centered","page__YMD-button"),c.classList.add("d-button-inner","deco-button-stylable"),r.classList.add("d-button__inner"),d.classList.add("YMD-icon","page__YMD-icon"),o.title="Загрузить",document.body.classList.contains("theme-black")?d.classList.add("YMD-icon-dark"):d.classList.add("YMD-icon-light"),r.append(d),c.append(r),o.append(c),o.addEventListener("click",s((()=>{const e=window.location.pathname.split("/");a(e[2])}),t)),n.append(o)})(o):(document.querySelector(".page-main__chart")||document.querySelector(".page-metatag"))&&i()})).observe(n,{attributes:!1,childList:!0,subtree:!0})}()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95YW5kZXgtbXVzaWMtZG93bmxvYWRlci8uL3NyYy9iYWNrZ3JvdW5kL2ludGVyZmFjZXMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8veWFuZGV4LW11c2ljLWRvd25sb2FkZXIvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8veWFuZGV4LW11c2ljLWRvd25sb2FkZXIvLi9zcmMvY29udGVudC9pbmRleC50cyJdLCJuYW1lcyI6WyJDaHJvbWVNZXNzYWdlVHlwZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiREVCT1VOQ0VfVElNRU9VVCIsImxvY2FsZSIsImRvbWFpbnMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhvc3QiLCJzcGxpdCIsImxlbmd0aCIsInBvcnQiLCJjaHJvbWUiLCJydW50aW1lIiwiY29ubmVjdCIsIm5hbWUiLCJkZWJvdW5jZSIsImZ1bmMiLCJ3YWl0IiwiaW1tZWRpYXRlIiwidGltZW91dCIsImNvbnRleHQiLCJ0aGlzIiwiYXJncyIsImFyZ3VtZW50cyIsImxhdGVyIiwiYXBwbHkiLCJjYWxsTm93IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImRvd25sb2FkVHJhY2siLCJ0cmFja0lkIiwibWVzc2FnZSIsInR5cGUiLCJET1dOTE9BRF9UUkFDSyIsInBvc3RNZXNzYWdlIiwiZG93bmxvYWRBbGJ1bSIsImFsYnVtSWQiLCJET1dOTE9BRF9BTEJVTSIsImdldFRyYWNrSWRGcm9tRWxlbWVudCIsImVsZW1lbnQiLCJhIiwicXVlcnlTZWxlY3RvciIsImdldEF0dHJpYnV0ZSIsImFkZENlbnRlcmJsb2NrVHJhY2tJY29ucyIsImNlbnRlcmJsb2NrIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInRyYWNrRWxlbWVudCIsImFjdGlvbnMiLCJpY29uIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImJvZHkiLCJjb250YWlucyIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0aXRsZSIsInByZXBlbmQiLCJ0YXJnZXROb2RlIiwiTXV0YXRpb25PYnNlcnZlciIsImljb25zIiwiZGFyayIsInJlbW92ZSIsIm9ic2VydmUiLCJhdHRyaWJ1dGVzIiwiY2hpbGRMaXN0Iiwic3VidHJlZSIsIl9tdXRhdGlvbnNMaXN0Iiwib2JzZXJ2ZXIiLCJwYXIiLCJwYXJQb2RjYXN0IiwiZGl2IiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJ1cmwiLCJhZGRQbGF5ZXJJY29uIiwiZGlzY29ubmVjdCIsImFsbFNpZGViYXJzIiwic2lkZWJhckNvbnRhaW5zVHJhY2tzIiwic2lkZWJhciIsInNpZGViYXJDb250cm9scyIsImJ1dHRvbiIsImlubmVyMSIsImlubmVyMiIsImFwcGVuZCIsInBhcnRzIiwib3duZXIiLCJraW5kIiwiRE9XTkxPQURfUExBWUxJU1QiLCJkb3dubG9hZFBsYXlsaXN0IiwiYWRkU2lkZWJhckljb25zIiwic2lkZWJhcnMiLCJ0b1JlbW92ZSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInJlbW92ZVNpZGViYXJJY29ucyIsImFydGlzdFBhZ2UiLCJidXR0b25Db250YWluZXIiLCJhcnRpc3RJZCIsIkRPV05MT0FEX0FSVElTVCIsImRvd25sb2FkQXJ0aXN0IiwicGF0aG5hbWUiLCJhZGRBcnRpc3RQYWdlSWNvbnMiLCJhbGJ1bVBhZ2UiLCJhZGRBbGJ1bVBhZ2VJY29ucyJdLCJtYXBwaW5ncyI6InVDQUVBLElBQVlBLEUsNkVBQUFBLEVBQUEsRUFBQUEsb0JBQUEsRUFBQUEsa0JBQWlCLEtBQzNCLHFDQUNBLHVDQUNBLDZDQUNBLHlDQUVBLHFEQUNBLCtDQUVBLHVDQUNBLG1EQUNBLGlDQUVBLGlEQUNBLGtEQ2ZFQyxFQUEyQixHQUcvQixTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMs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U0FBU2dHLFNBQVM5RixNQUFNLEtBQzdDMkIsRUFBY21ELEVBQU0sTUFDbkJwRixJQUdMZ0csRUFBZ0JiLE9BQU9ILElBeUVuQnVCLENBQWtCRCxJQUlGM0QsU0FBU0osY0FBYyxzQkFNckJJLFNBQVNKLGNBQWMsbUJBSnpDRSxPQVVLcUIsUUFBUUwsRUEzQkYsQ0FBQ00sWUFBWSxFQUFPQyxXQUFXLEVBQU1DLFNBQVMsSUFGL0QsSSIsImZpbGUiOiJjb250ZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFdmVudFR5cGUsIERvd25sb2FkSXRlbX0gZnJvbSAnLi4vc2VydmljZXMvZG93bmxvYWQtbWFuYWdlci9pbnRlcmZhY2VzJztcblxuZXhwb3J0IGVudW0gQ2hyb21lTWVzc2FnZVR5cGUge1xuICBET1dOTE9BRF9UUkFDSyA9IDAsXG4gIERPV05MT0FEX0FMQlVNID0gMSxcbiAgRE9XTkxPQURfUExBWUxJU1QgPSAyLFxuICBET1dOTE9BRF9BUlRJU1QgPSAzLFxuXG4gIEFERF9ET1dOTE9BRF9MSVNURU5FUiA9IDQsXG4gIEFERF9FUlJPUl9MSVNURU5FUiA9IDUsXG5cbiAgRE9XTkxPQURfRVZFTlQgPSA2LFxuICBET1dOTE9BRF9FUlJPUl9FVkVOVCA9IDcsXG4gIEVSUk9SX0VWRU5UID0gOCxcblxuICBMSVNUX0RPV05MT0FEX0lURU1TID0gOSxcbiAgSU5URVJSVVBUX0RPV05MT0FEID0gMTAsXG59XG5cbmV4cG9ydCB0eXBlIENocm9tZU1lc3NhZ2UgPVxuICB8IHtcbiAgICAgIHR5cGU6IENocm9tZU1lc3NhZ2VUeXBlLkRPV05MT0FEX1RSQUNLO1xuICAgICAgdHJhY2tJZDogbnVtYmVyO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiBDaHJvbWVNZXNzYWdlVHlwZS5ET1dOTE9BRF9BTEJVTTtcbiAgICAgIGFsYnVtSWQ6IG51bWJlcjtcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfUExBWUxJU1Q7XG4gICAgICBvd25lcjogc3RyaW5nIHwgbnVtYmVyO1xuICAgICAga2luZDogbnVtYmVyO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiBDaHJvbWVNZXNzYWdlVHlwZS5ET1dOTE9BRF9BUlRJU1Q7XG4gICAgICBhcnRpc3RJZDogbnVtYmVyO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiBDaHJvbWVNZXNzYWdlVHlwZS5BRERfRE9XTkxPQURfTElTVEVORVI7XG4gICAgfVxuICB8IHtcbiAgICAgIHR5cGU6IENocm9tZU1lc3NhZ2VUeXBlLkFERF9FUlJPUl9MSVNURU5FUjtcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfRVZFTlQ7XG4gICAgICBldmVudFR5cGU6IEV2ZW50VHlwZTtcbiAgICAgIGRvd25sb2FkSXRlbTogRG93bmxvYWRJdGVtICYge2J5dGVzOiBudWxsfTtcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfRVJST1JfRVZFTlQ7XG4gICAgICBkb3dubG9hZEl0ZW06IERvd25sb2FkSXRlbSAmIHtieXRlczogbnVsbH07XG4gICAgICBlcnJvcjogRXJyb3I7XG4gICAgfVxuICB8IHtcbiAgICAgIHR5cGU6IENocm9tZU1lc3NhZ2VUeXBlLkVSUk9SX0VWRU5UO1xuICAgICAgZXJyb3I6IEVycm9yO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiBDaHJvbWVNZXNzYWdlVHlwZS5MSVNUX0RPV05MT0FEX0lURU1TO1xuICAgICAgaXRlbXM6IChEb3dubG9hZEl0ZW0gJiB7Ynl0ZXM6IG51bGx9KVtdO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiBDaHJvbWVNZXNzYWdlVHlwZS5JTlRFUlJVUFRfRE9XTkxPQUQ7XG4gICAgICBkb3dubG9hZEl0ZW1JZDogbnVtYmVyO1xuICAgIH07XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHtDaHJvbWVNZXNzYWdlVHlwZSwgQ2hyb21lTWVzc2FnZX0gZnJvbSAnLi4vYmFja2dyb3VuZC9pbnRlcmZhY2VzJztcblxuY29uc3QgREVCT1VOQ0VfVElNRU9VVCA9IDEwMDA7XG5cbmNvbnN0IGxvY2FsZSA9ICgoKSA9PiB7XG4gIGNvbnN0IGRvbWFpbnMgPSB3aW5kb3cubG9jYXRpb24uaG9zdC5zcGxpdCgnLicpO1xuICByZXR1cm4gZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdO1xufSkoKTtcbmNvbnN0IHBvcnQgPSBjaHJvbWUucnVudGltZS5jb25uZWN0KHtuYW1lOiBsb2NhbGV9KTtcblxuLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvclxuLy8gTiBtaWxsaXNlY29uZHMuIElmIGBpbW1lZGlhdGVgIGlzIHBhc3NlZCwgdHJpZ2dlciB0aGUgZnVuY3Rpb24gb24gdGhlXG4vLyBsZWFkaW5nIGVkZ2UsIGluc3RlYWQgb2YgdGhlIHRyYWlsaW5nLlxuZnVuY3Rpb24gZGVib3VuY2UoZnVuYzogRnVuY3Rpb24sIHdhaXQ6IG51bWJlciwgaW1tZWRpYXRlPzogYm9vbGVhbikge1xuICBsZXQgdGltZW91dDogTm9kZUpTLlRpbWVvdXQgfCBudWxsO1xuICByZXR1cm4gZnVuY3Rpb24gKHRoaXM6IEZ1bmN0aW9uKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzXG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMsXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXJlc3QtcGFyYW1zXG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgIGNvbnN0IGxhdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICBpZiAoIWltbWVkaWF0ZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9O1xuICAgIGNvbnN0IGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQhKTtcbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgaWYgKGNhbGxOb3cpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gIH07XG59XG5cbmNvbnN0IGRvd25sb2FkVHJhY2sgPSAodHJhY2tJZDogbnVtYmVyIHwgc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG1lc3NhZ2U6IENocm9tZU1lc3NhZ2UgPSB7XG4gICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfVFJBQ0ssXG4gICAgdHJhY2tJZDogK3RyYWNrSWQsXG4gIH07XG5cbiAgcG9ydC5wb3N0TWVzc2FnZShtZXNzYWdlKTtcbn07XG5cbmNvbnN0IGRvd25sb2FkQWxidW0gPSAoYWxidW1JZDogbnVtYmVyIHwgc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG1lc3NhZ2U6IENocm9tZU1lc3NhZ2UgPSB7XG4gICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfQUxCVU0sXG4gICAgYWxidW1JZDogK2FsYnVtSWQsXG4gIH07XG4gIHBvcnQucG9zdE1lc3NhZ2UobWVzc2FnZSk7XG59O1xuXG5jb25zdCBkb3dubG9hZEFydGlzdCA9IChhcnRpc3RJZDogbnVtYmVyIHwgc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG1lc3NhZ2U6IENocm9tZU1lc3NhZ2UgPSB7XG4gICAgdHlwZTogQ2hyb21lTWVzc2FnZVR5cGUuRE9XTkxPQURfQVJUSVNULFxuICAgIGFydGlzdElkOiArYXJ0aXN0SWQsXG4gIH07XG4gIHBvcnQucG9zdE1lc3NhZ2UobWVzc2FnZSk7XG59O1xuXG5jb25zdCBkb3dubG9hZFBsYXlsaXN0ID0gKG93bmVyOiBudW1iZXIgfCBzdHJpbmcsIGtpbmQ6IG51bWJlciB8IHN0cmluZykgPT4ge1xuICBjb25zdCBtZXNzYWdlOiBDaHJvbWVNZXNzYWdlID0ge1xuICAgIHR5cGU6IENocm9tZU1lc3NhZ2VUeXBlLkRPV05MT0FEX1BMQVlMSVNULFxuICAgIG93bmVyLFxuICAgIGtpbmQ6ICtraW5kLFxuICB9O1xuICBwb3J0LnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xufTtcblxuY29uc3Qgc2lkZWJhckNvbnRhaW5zVHJhY2tzID0gKCkgPT4ge1xuICAvLyBtdWx0aXBsZSBzaWRlYmFycyBvbmZyb250IGVhY2ggb3RoZXJcbiAgY29uc3QgYWxsU2lkZWJhcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2lkZWJhci1jb250Jyk7XG4gIGlmICghYWxsU2lkZWJhcnMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gIC8vIGdldCB0aGUgb25lIG9uIHRoZSB0b3BcbiAgY29uc3Qgc2lkZWJhciA9IGFsbFNpZGViYXJzW2FsbFNpZGViYXJzLmxlbmd0aCAtIDFdO1xuICByZXR1cm4gc2lkZWJhci5xdWVyeVNlbGVjdG9yQWxsKCcuc2lkZWJhcl9fdHJhY2tzIC5kLXRyYWNrJykubGVuZ3RoID4gMDtcbn07XG5cbmNvbnN0IGdldFRyYWNrSWRGcm9tRWxlbWVudCA9IChlbGVtZW50OiBFbGVtZW50KTogbnVtYmVyIHwgbnVsbCA9PiB7XG4gIGNvbnN0IGEgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kLXRyYWNrX19uYW1lIGEnKTtcbiAgaWYgKCFhKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCB1cmwgPSBhLmdldEF0dHJpYnV0ZSgnaHJlZicpITtcbiAgcmV0dXJuICt1cmwuc3BsaXQoJy8nKVs0XTtcbn07XG5cbmNvbnN0IGFkZFRyYWNrSWNvbnMgPSAodHJhY2tFbGVtZW50czogTm9kZUxpc3RPZjxFbGVtZW50PikgPT4ge1xuICB0cmFja0VsZW1lbnRzLmZvckVhY2godHJhY2tFbGVtZW50ID0+IHtcbiAgICBpZiAodHJhY2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ZTUQtaWNvbicpKSByZXR1cm47XG4gICAgY29uc3QgYWN0aW9ucyA9IHRyYWNrRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZC10cmFja19fYWN0aW9ucycpITtcbiAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXG4gICAgY29uc3QgdHJhY2tJZCA9IGdldFRyYWNrSWRGcm9tRWxlbWVudCh0cmFja0VsZW1lbnQpO1xuICAgIGlmICghdHJhY2tJZCkgcmV0dXJuO1xuXG4gICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbicsICdzaWRlYmFyX190cmFja19ZTUQtaWNvbicpO1xuICAgIGNvbnN0IGRhcmsgPSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygndGhlbWUtYmxhY2snKTtcbiAgICBpZiAoZGFyaykge1xuICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbi1kYXJrJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24tbGlnaHQnKTtcbiAgICB9XG5cbiAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgZG93bmxvYWRUcmFjayh0cmFja0lkKTtcbiAgICB9KTtcbiAgICBpY29uLnRpdGxlID0gJ9CX0LDQs9GA0YPQt9C40YLRjCc7XG4gICAgYWN0aW9ucy5wcmVwZW5kKGljb24pO1xuICB9KTtcbn07XG5cbmNvbnN0IGFkZFBsYXllckljb24gPSAoKSA9PiB7XG4gIGNvbnN0IHBhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItY29udHJvbHNfX3NlcS1jb250cm9scycpITtcbiAgY29uc3QgcGFyUG9kY2FzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgJy5wbGF5ZXItY29udHJvbHNfX3NwZWVkLWNvbnRyb2xzJ1xuICApITtcbiAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24nLCAncGxheWVyX19ZTURfaWNvbicpO1xuICBkaXYuY2xhc3NMaXN0LmFkZChcbiAgICAncGxheWVyLWNvbnRyb2xzX19idG4nLFxuICAgICdkZWNvLXBsYXllci1jb250cm9sc19fYnV0dG9uJyxcbiAgICAncGxheWVyLWNvbnRyb2xzX19idG5fZG93bmxvYWQnXG4gICk7XG5cbiAgZGl2LnRpdGxlID0gJ9CX0LDQs9GA0YPQt9C40YLRjCDRgtC10LrRg9GJ0LjQuSDRgtGA0LXQuic7XG5cbiAgY29uc3QgZGFyayA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCd0aGVtZS1ibGFjaycpO1xuICBpZiAoZGFyaykge1xuICAgIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24tZGFyaycpO1xuICB9IGVsc2Uge1xuICAgIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24tbGlnaHQnKTtcbiAgfVxuXG4gIGRpdi5hcHBlbmRDaGlsZChpY29uKTtcbiAgcGFyLmFwcGVuZENoaWxkKGRpdik7XG4gIHBhclBvZGNhc3QuYXBwZW5kQ2hpbGQoZGl2LmNsb25lTm9kZSh0cnVlKSk7XG5cbiAgcGFyLnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItY29udHJvbHNfX2J0bl9kb3dubG9hZCBzcGFuJykhLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgJ2NsaWNrJyxcbiAgICBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICBjb25zdCBhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllci1jb250cm9scyAudHJhY2tfX25hbWUgYScpITtcbiAgICAgIGNvbnN0IHVybCA9IGEuZ2V0QXR0cmlidXRlKCdocmVmJykhO1xuICAgICAgZG93bmxvYWRUcmFjaygrdXJsLnNwbGl0KCcvJylbNF0pO1xuICAgIH0sIERFQk9VTkNFX1RJTUVPVVQpXG4gICk7XG5cbiAgcGFyUG9kY2FzdFxuICAgIC5xdWVyeVNlbGVjdG9yKCcucGxheWVyLWNvbnRyb2xzX19idG5fZG93bmxvYWQgc3BhbicpIVxuICAgIC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ2NsaWNrJyxcbiAgICAgIGRlYm91bmNlKCgpID0+IHtcbiAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItY29udHJvbHMgLnRyYWNrX19uYW1lIGEnKSE7XG4gICAgICAgIGNvbnN0IHVybCA9IGEuZ2V0QXR0cmlidXRlKCdocmVmJykhO1xuICAgICAgICBkb3dubG9hZFRyYWNrKCt1cmwuc3BsaXQoJy8nKVs0XSk7XG4gICAgICB9LCBERUJPVU5DRV9USU1FT1VUKVxuICAgICk7XG59O1xuXG5jb25zdCBhZGRTaWRlYmFySWNvbnMgPSAoKSA9PiB7XG4gIGNvbnN0IGFsbFNpZGViYXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNpZGViYXItY29udCcpO1xuICBjb25zdCBzaWRlYmFyID0gYWxsU2lkZWJhcnNbYWxsU2lkZWJhcnMubGVuZ3RoIC0gMV07XG4gIGNvbnN0IHNpZGViYXJDb250cm9scyA9IHNpZGViYXIucXVlcnlTZWxlY3RvcignLnNpZGViYXJfX2NvbnRyb2xzJykhO1xuICBjb25zdCBzaWRlYmFyVHJhY2tzID0gc2lkZWJhci5xdWVyeVNlbGVjdG9yQWxsKCcuc2lkZWJhcl9fdHJhY2tzIC5kLXRyYWNrJyk7XG5cbiAgYWRkVHJhY2tJY29ucyhzaWRlYmFyVHJhY2tzKTtcblxuICAvLyBjaGVjayBpZiBpY29uIGlzIHNldCBhbHJlYWR5XG4gIGlmIChzaWRlYmFyQ29udHJvbHMucXVlcnlTZWxlY3RvcignLnNpZGViYXJfX1lNRC1pY29uJykpIHJldHVybjtcbiAgLy8gc2tpcCBzaWRlYmFyIHdpdGggYXJ0aXN0cyB0cmFja3NcbiAgaWYgKHNpZGViYXIucXVlcnlTZWxlY3RvcignLnNpZGViYXItYXJ0aXN0JykpIHJldHVybjtcblxuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgY29uc3QgaW5uZXIxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb25zdCBpbm5lcjIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKFxuICAgICdkLWJ1dHRvbicsXG4gICAgJ2RlY28tYnV0dG9uJyxcbiAgICAnZGVjby1idXR0b24tdHJhbnNwYXJlbnQnLFxuICAgICdkLWJ1dHRvbl9yb3VuZGVkJyxcbiAgICAnZC1idXR0b25fc2l6ZV9MJyxcbiAgICAnZC1idXR0b25fdy1pY29uJyxcbiAgICAnZC1idXR0b25fdy1pY29uLWNlbnRlcmVkJyxcbiAgICAnc2lkZWJhcl9fWU1ELWJ1dHRvbidcbiAgKTtcbiAgaW5uZXIxLmNsYXNzTGlzdC5hZGQoJ2QtYnV0dG9uLWlubmVyJywgJ2RlY28tYnV0dG9uLXN0eWxhYmxlJyk7XG4gIGlubmVyMi5jbGFzc0xpc3QuYWRkKCdkLWJ1dHRvbl9faW5uZXInKTtcbiAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbicsICdzaWRlYmFyX19ZTUQtaWNvbicpO1xuICBidXR0b24udGl0bGUgPSAn0JfQsNCz0YDRg9C30LjRgtGMJztcbiAgY29uc3QgZGFyayA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCd0aGVtZS1ibGFjaycpO1xuICBpZiAoZGFyaykge1xuICAgIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24tZGFyaycpO1xuICB9IGVsc2Uge1xuICAgIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24tbGlnaHQnKTtcbiAgfVxuICBpbm5lcjIuYXBwZW5kKGljb24pO1xuICBpbm5lcjEuYXBwZW5kKGlubmVyMik7XG4gIGJ1dHRvbi5hcHBlbmQoaW5uZXIxKTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAnY2xpY2snLFxuICAgIGRlYm91bmNlKCgpID0+IHtcbiAgICAgIGNvbnN0IGEgPSBzaWRlYmFyLnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFyX190aXRsZSBhJyk7XG4gICAgICBpZiAoIWEpIHJldHVybjtcblxuICAgICAgY29uc3QgcGFydHMgPSBhLmdldEF0dHJpYnV0ZSgnaHJlZicpIS5zcGxpdCgnLycpO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gNSkge1xuICAgICAgICBpZiAoc2lkZWJhci5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhci10cmFjayAnKSkge1xuICAgICAgICAgIC8qIG9ubHkgdHJhY2sgKi9cbiAgICAgICAgICBkb3dubG9hZFRyYWNrKHBhcnRzWzRdKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLyogcGxheWxpc3QgKi9cbiAgICAgICAgZG93bmxvYWRQbGF5bGlzdChwYXJ0c1syXSwgcGFydHNbNF0pO1xuICAgICAgfSBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgLyogYWxidW0gKi9cbiAgICAgICAgZG93bmxvYWRBbGJ1bShwYXJ0c1syXSk7XG4gICAgICB9XG4gICAgfSwgREVCT1VOQ0VfVElNRU9VVClcbiAgKTtcbiAgc2lkZWJhckNvbnRyb2xzLmFwcGVuZChidXR0b24pO1xufTtcblxuY29uc3QgYWRkQ2VudGVyYmxvY2tUcmFja0ljb25zID0gKCkgPT4ge1xuICBjb25zdCBjZW50ZXJibG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jZW50ZXJibG9jaycpO1xuICBpZiAoIWNlbnRlcmJsb2NrKSByZXR1cm47XG5cbiAgY29uc3QgdHJhY2tzID0gY2VudGVyYmxvY2sucXVlcnlTZWxlY3RvckFsbCgnLmQtdHJhY2snKTtcblxuICB0cmFja3MuZm9yRWFjaCh0cmFja0VsZW1lbnQgPT4ge1xuICAgIGlmICh0cmFja0VsZW1lbnQucXVlcnlTZWxlY3RvcignLllNRC1pY29uJykpIHJldHVybjtcbiAgICBjb25zdCBhY3Rpb25zID0gdHJhY2tFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kLXRyYWNrX19hY3Rpb25zJykhO1xuICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG5cbiAgICBjb25zdCB0cmFja0lkID0gZ2V0VHJhY2tJZEZyb21FbGVtZW50KHRyYWNrRWxlbWVudCk7XG4gICAgaWYgKCF0cmFja0lkKSByZXR1cm47XG5cbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uJywgJ3BhZ2VfX3RyYWNrX1lNRC1pY29uJyk7XG4gICAgY29uc3QgZGFyayA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCd0aGVtZS1ibGFjaycpO1xuICAgIGlmIChkYXJrKSB7XG4gICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uLWRhcmsnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbi1saWdodCcpO1xuICAgIH1cblxuICAgIGljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBkb3dubG9hZFRyYWNrKHRyYWNrSWQpO1xuICAgIH0pO1xuICAgIGljb24udGl0bGUgPSAn0JfQsNCz0YDRg9C30LjRgtGMJztcbiAgICBhY3Rpb25zLnByZXBlbmQoaWNvbik7XG4gIH0pO1xufTtcblxuY29uc3QgYWRkQXJ0aXN0UGFnZUljb25zID0gKGFydGlzdFBhZ2U6IEVsZW1lbnQpID0+IHtcbiAgYWRkQ2VudGVyYmxvY2tUcmFja0ljb25zKCk7XG5cbiAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gYXJ0aXN0UGFnZS5xdWVyeVNlbGVjdG9yKFxuICAgICcuZC1nZW5lcmljLXBhZ2UtaGVhZF9fbWFpbi1hY3Rpb25zJ1xuICApITtcblxuICBpZiAoYnV0dG9uQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5ZTUQtaWNvbicpKSByZXR1cm47XG5cbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGNvbnN0IGlubmVyMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29uc3QgaW5uZXIyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBidXR0b24uY2xhc3NMaXN0LmFkZChcbiAgICAnZC1idXR0b24nLFxuICAgICdkZWNvLWJ1dHRvbicsXG4gICAgJ2RlY28tYnV0dG9uLXRyYW5zcGFyZW50JyxcbiAgICAnZC1idXR0b25fcm91bmRlZCcsXG4gICAgJ2QtYnV0dG9uX3NpemVfTCcsXG4gICAgJ2QtYnV0dG9uX3ctaWNvbicsXG4gICAgJ2QtYnV0dG9uX3ctaWNvbi1jZW50ZXJlZCcsXG4gICAgJ3BhZ2VfX1lNRC1idXR0b24nXG4gICk7XG4gIGlubmVyMS5jbGFzc0xpc3QuYWRkKCdkLWJ1dHRvbi1pbm5lcicsICdkZWNvLWJ1dHRvbi1zdHlsYWJsZScpO1xuICBpbm5lcjIuY2xhc3NMaXN0LmFkZCgnZC1idXR0b25fX2lubmVyJyk7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24nLCAncGFnZV9fWU1ELWljb24nKTtcbiAgYnV0dG9uLnRpdGxlID0gJ9CX0LDQs9GA0YPQt9C40YLRjCc7XG4gIGNvbnN0IGRhcmsgPSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygndGhlbWUtYmxhY2snKTtcbiAgaWYgKGRhcmspIHtcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uLWRhcmsnKTtcbiAgfSBlbHNlIHtcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uLWxpZ2h0Jyk7XG4gIH1cbiAgaW5uZXIyLmFwcGVuZChpY29uKTtcbiAgaW5uZXIxLmFwcGVuZChpbm5lcjIpO1xuICBidXR0b24uYXBwZW5kKGlubmVyMSk7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgJ2NsaWNrJyxcbiAgICBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpO1xuICAgICAgZG93bmxvYWRBcnRpc3QocGFydHNbMl0pO1xuICAgIH0sIERFQk9VTkNFX1RJTUVPVVQpXG4gICk7XG5cbiAgYnV0dG9uQ29udGFpbmVyLmFwcGVuZChidXR0b24pO1xufTtcblxuY29uc3QgYWRkQWxidW1QYWdlSWNvbnMgPSAoYWxidW1QYWdlOiBFbGVtZW50KSA9PiB7XG4gIGFkZENlbnRlcmJsb2NrVHJhY2tJY29ucygpO1xuXG4gIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGFsYnVtUGFnZS5xdWVyeVNlbGVjdG9yKFxuICAgICcuZC1nZW5lcmljLXBhZ2UtaGVhZF9fbWFpbi1hY3Rpb25zJ1xuICApITtcblxuICBpZiAoYnV0dG9uQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5ZTUQtaWNvbicpKSByZXR1cm47XG5cbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGNvbnN0IGlubmVyMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29uc3QgaW5uZXIyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBidXR0b24uY2xhc3NMaXN0LmFkZChcbiAgICAnZC1idXR0b24nLFxuICAgICdkZWNvLWJ1dHRvbicsXG4gICAgJ2RlY28tYnV0dG9uLXRyYW5zcGFyZW50JyxcbiAgICAnZC1idXR0b25fcm91bmRlZCcsXG4gICAgJ2QtYnV0dG9uX3NpemVfTCcsXG4gICAgJ2QtYnV0dG9uX3ctaWNvbicsXG4gICAgJ2QtYnV0dG9uX3ctaWNvbi1jZW50ZXJlZCcsXG4gICAgJ3BhZ2VfX1lNRC1idXR0b24nXG4gICk7XG4gIGlubmVyMS5jbGFzc0xpc3QuYWRkKCdkLWJ1dHRvbi1pbm5lcicsICdkZWNvLWJ1dHRvbi1zdHlsYWJsZScpO1xuICBpbm5lcjIuY2xhc3NMaXN0LmFkZCgnZC1idXR0b25fX2lubmVyJyk7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnWU1ELWljb24nLCAncGFnZV9fWU1ELWljb24nKTtcbiAgYnV0dG9uLnRpdGxlID0gJ9CX0LDQs9GA0YPQt9C40YLRjCc7XG4gIGNvbnN0IGRhcmsgPSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygndGhlbWUtYmxhY2snKTtcbiAgaWYgKGRhcmspIHtcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uLWRhcmsnKTtcbiAgfSBlbHNlIHtcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ1lNRC1pY29uLWxpZ2h0Jyk7XG4gIH1cbiAgaW5uZXIyLmFwcGVuZChpY29uKTtcbiAgaW5uZXIxLmFwcGVuZChpbm5lcjIpO1xuICBidXR0b24uYXBwZW5kKGlubmVyMSk7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgJ2NsaWNrJyxcbiAgICBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpO1xuICAgICAgZG93bmxvYWRBbGJ1bShwYXJ0c1syXSk7XG4gICAgfSwgREVCT1VOQ0VfVElNRU9VVClcbiAgKTtcblxuICBidXR0b25Db250YWluZXIuYXBwZW5kKGJ1dHRvbik7XG59O1xuXG5jb25zdCByZW1vdmVTaWRlYmFySWNvbnMgPSAoKSA9PiB7XG4gIGNvbnN0IHNpZGViYXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNpZGViYXItY29udCcpO1xuICBpZiAoIXNpZGViYXJzLmxlbmd0aCkgcmV0dXJuO1xuICBjb25zdCBzaWRlYmFyID0gc2lkZWJhcnNbc2lkZWJhcnMubGVuZ3RoIC0gMV07XG4gIGNvbnN0IHRvUmVtb3ZlID0gc2lkZWJhci5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhcl9fWU1ELWJ1dHRvbicpO1xuICBpZiAoIXRvUmVtb3ZlKSByZXR1cm47XG4gIHRvUmVtb3ZlLnBhcmVudE5vZGUhLnJlbW92ZUNoaWxkKHRvUmVtb3ZlKTtcbn07XG5cbihmdW5jdGlvbiBvYnNlcnZlRGFya1RoZW1lKCkge1xuICBjb25zdCB0YXJnZXROb2RlID0gZG9jdW1lbnQuYm9keTtcbiAgY29uc3QgY29uZmlnID0ge2F0dHJpYnV0ZXM6IHRydWUsIGNoaWxkTGlzdDogZmFsc2UsIHN1YnRyZWU6IGZhbHNlfTtcbiAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7XG4gICAgY29uc3QgaWNvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuWU1ELWljb24nKTtcbiAgICBjb25zdCBkYXJrID0gZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3RoZW1lLWJsYWNrJyk7XG4gICAgaWNvbnMuZm9yRWFjaChpY29uID0+IHtcbiAgICAgIGlmIChkYXJrKSB7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnWU1ELWljb24tbGlnaHQnKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbi1kYXJrJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ1lNRC1pY29uLWRhcmsnKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdZTUQtaWNvbi1saWdodCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXROb2RlLCBjb25maWcpO1xufSkoKTtcblxuKGZ1bmN0aW9uIG9ic2VydmVQbGF5ZXIoKSB7XG4gIGNvbnN0IHRhcmdldE5vZGUgPSBkb2N1bWVudC5ib2R5O1xuICBjb25zdCBjb25maWcgPSB7YXR0cmlidXRlczogZmFsc2UsIGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZX07XG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKF9tdXRhdGlvbnNMaXN0LCBvYnNlcnZlcikgPT4ge1xuICAgIGlmIChcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItY29udHJvbHNfX3NlcS1jb250cm9scycpICYmXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyLWNvbnRyb2xzX19zcGVlZC1jb250cm9scycpXG4gICAgKSB7XG4gICAgICBhZGRQbGF5ZXJJY29uKCk7XG4gICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgfVxuICB9KTtcbiAgb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXROb2RlLCBjb25maWcpO1xufSkoKTtcblxuKGZ1bmN0aW9uIG9ic2VydmVTaWRlYmFyKCkge1xuICBjb25zdCB0YXJnZXROb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGViYXInKSE7XG4gIGNvbnN0IGNvbmZpZyA9IHthdHRyaWJ1dGVzOiBmYWxzZSwgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlfTtcblxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICBpZiAoc2lkZWJhckNvbnRhaW5zVHJhY2tzKCkpIHtcbiAgICAgIGFkZFNpZGViYXJJY29ucygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVTaWRlYmFySWNvbnMoKTtcbiAgICB9XG4gIH0pO1xuICBvYnNlcnZlci5vYnNlcnZlKHRhcmdldE5vZGUsIGNvbmZpZyk7XG59KSgpO1xuXG4oZnVuY3Rpb24gb2JzZXJ2ZUNlbnRlcmJsb2NrKCkge1xuICBjb25zdCB0YXJnZXROb2RlID0gZG9jdW1lbnQuYm9keTtcbiAgY29uc3QgY29uZmlnID0ge2F0dHJpYnV0ZXM6IGZhbHNlLCBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9O1xuXG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xuICAgIGNvbnN0IGFydGlzdFBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFnZS1hcnRpc3QnKTtcbiAgICBpZiAoYXJ0aXN0UGFnZSkge1xuICAgICAgYWRkQXJ0aXN0UGFnZUljb25zKGFydGlzdFBhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGFsYnVtUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wYWdlLWFsYnVtJyk7XG4gICAgaWYgKGFsYnVtUGFnZSkge1xuICAgICAgYWRkQWxidW1QYWdlSWNvbnMoYWxidW1QYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjaGFydFBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFnZS1tYWluX19jaGFydCcpO1xuICAgIGlmIChjaGFydFBhZ2UpIHtcbiAgICAgIGFkZENlbnRlcmJsb2NrVHJhY2tJY29ucygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG1ldGF0YWdQYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhZ2UtbWV0YXRhZycpO1xuICAgIGlmIChtZXRhdGFnUGFnZSkge1xuICAgICAgYWRkQ2VudGVyYmxvY2tUcmFja0ljb25zKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9KTtcbiAgb2JzZXJ2ZXIub2JzZXJ2ZSh0YXJnZXROb2RlLCBjb25maWcpO1xufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=