var content=function(){"use strict";var ye=Object.defineProperty;var pe=(T,_,S)=>_ in T?ye(T,_,{enumerable:!0,configurable:!0,writable:!0,value:S}):T[_]=S;var K=(T,_,S)=>pe(T,typeof _!="symbol"?_+"":_,S);var G,Y,Q,z;function T(s){return s}var _=Object.prototype.hasOwnProperty;function S(s,e){var t,r;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((r=s.length)===e.length)for(;r--&&S(s[r],e[r]););return r===-1}if(!t||typeof s=="object"){r=0;for(t in s)if(_.call(s,t)&&++r&&!_.call(e,t)||!(t in e)||!S(s[t],e[t]))return!1;return Object.keys(e).length===r}}return s!==s&&e!==e}const ee=new Error("request for lock canceled");var te=function(s,e,t,r){function c(u){return u instanceof t?u:new t(function(d){d(u)})}return new(t||(t=Promise))(function(u,d){function m(g){try{E(r.next(g))}catch(I){d(I)}}function b(g){try{E(r.throw(g))}catch(I){d(I)}}function E(g){g.done?u(g.value):c(g.value).then(m,b)}E((r=r.apply(s,e||[])).next())})};class re{constructor(e,t=ee){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((r,c)=>{const u={resolve:r,reject:c,weight:e,priority:t},d=D(this._queue,m=>t<=m.priority);d===-1&&e<=this._value?this._dispatchItem(u):this._queue.splice(d+1,0,u)})}runExclusive(e){return te(this,arguments,void 0,function*(t,r=1,c=0){const[u,d]=yield this.acquire(r,c);try{return yield t(u)}finally{d()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),ne(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(r=>r.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];if(!r)continue;const c=r.findIndex(u=>u.priority<=e);(c===-1?r:r.splice(0,c)).forEach(u=>u.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function ne(s,e){const t=D(s,r=>e.priority<=r.priority);s.splice(t+1,0,e)}function D(s,e){for(let t=s.length-1;t>=0;t--)if(e(s[t]))return t;return-1}var ie=function(s,e,t,r){function c(u){return u instanceof t?u:new t(function(d){d(u)})}return new(t||(t=Promise))(function(u,d){function m(g){try{E(r.next(g))}catch(I){d(I)}}function b(g){try{E(r.throw(g))}catch(I){d(I)}}function E(g){g.done?u(g.value):c(g.value).then(m,b)}E((r=r.apply(s,e||[])).next())})};class se{constructor(e){this._semaphore=new re(1,e)}acquire(){return ie(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const $=((Y=(G=globalThis.browser)==null?void 0:G.runtime)==null?void 0:Y.id)==null?globalThis.chrome:globalThis.browser,F=ae();function ae(){const s={local:O("local"),session:O("session"),sync:O("sync"),managed:O("managed")},e=o=>{const i=s[o];if(i==null){const n=Object.keys(s).join(", ");throw Error(`Invalid area "${o}". Options: ${n}`)}return i},t=o=>{const i=o.indexOf(":"),n=o.substring(0,i),a=o.substring(i+1);if(a==null)throw Error(`Storage key should be in the form of "area:key", but received "${o}"`);return{driverArea:n,driverKey:a,driver:e(n)}},r=o=>o+"$",c=(o,i)=>{const n={...o};return Object.entries(i).forEach(([a,l])=>{l==null?delete n[a]:n[a]=l}),n},u=(o,i)=>o??i??null,d=o=>typeof o=="object"&&!Array.isArray(o)?o:{},m=async(o,i,n)=>{const a=await o.getItem(i);return u(a,(n==null?void 0:n.fallback)??(n==null?void 0:n.defaultValue))},b=async(o,i)=>{const n=r(i),a=await o.getItem(n);return d(a)},E=async(o,i,n)=>{await o.setItem(i,n??null)},g=async(o,i,n)=>{const a=r(i),l=d(await o.getItem(a));await o.setItem(a,c(l,n))},I=async(o,i,n)=>{if(await o.removeItem(i),n!=null&&n.removeMeta){const a=r(i);await o.removeItem(a)}},Z=async(o,i,n)=>{const a=r(i);if(n==null)await o.removeItem(a);else{const l=d(await o.getItem(a));[n].flat().forEach(h=>delete l[h]),await o.setItem(a,l)}},J=(o,i,n)=>o.watch(i,n);return{getItem:async(o,i)=>{const{driver:n,driverKey:a}=t(o);return await m(n,a,i)},getItems:async o=>{const i=new Map,n=new Map,a=[];o.forEach(h=>{let f,v;typeof h=="string"?f=h:"getValue"in h?(f=h.key,v={fallback:h.fallback}):(f=h.key,v=h.options),a.push(f);const{driverArea:M,driverKey:y}=t(f),p=i.get(M)??[];i.set(M,p.concat(y)),n.set(f,v)});const l=new Map;return await Promise.all(Array.from(i.entries()).map(async([h,f])=>{(await s[h].getItems(f)).forEach(M=>{const y=`${h}:${M.key}`,p=n.get(y),w=u(M.value,(p==null?void 0:p.fallback)??(p==null?void 0:p.defaultValue));l.set(y,w)})})),a.map(h=>({key:h,value:l.get(h)}))},getMeta:async o=>{const{driver:i,driverKey:n}=t(o);return await b(i,n)},getMetas:async o=>{const i=o.map(l=>{const h=typeof l=="string"?l:l.key,{driverArea:f,driverKey:v}=t(h);return{key:h,driverArea:f,driverKey:v,driverMetaKey:r(v)}}),n=i.reduce((l,h)=>{var f;return l[f=h.driverArea]??(l[f]=[]),l[h.driverArea].push(h),l},{}),a={};return await Promise.all(Object.entries(n).map(async([l,h])=>{const f=await $.storage[l].get(h.map(v=>v.driverMetaKey));h.forEach(v=>{a[v.key]=f[v.driverMetaKey]??{}})})),i.map(l=>({key:l.key,meta:a[l.key]}))},setItem:async(o,i)=>{const{driver:n,driverKey:a}=t(o);await E(n,a,i)},setItems:async o=>{const i={};o.forEach(n=>{const{driverArea:a,driverKey:l}=t("key"in n?n.key:n.item.key);i[a]??(i[a]=[]),i[a].push({key:l,value:n.value})}),await Promise.all(Object.entries(i).map(async([n,a])=>{await e(n).setItems(a)}))},setMeta:async(o,i)=>{const{driver:n,driverKey:a}=t(o);await g(n,a,i)},setMetas:async o=>{const i={};o.forEach(n=>{const{driverArea:a,driverKey:l}=t("key"in n?n.key:n.item.key);i[a]??(i[a]=[]),i[a].push({key:l,properties:n.meta})}),await Promise.all(Object.entries(i).map(async([n,a])=>{const l=e(n),h=a.map(({key:y})=>r(y));console.log(n,h);const f=await l.getItems(h),v=Object.fromEntries(f.map(({key:y,value:p})=>[y,d(p)])),M=a.map(({key:y,properties:p})=>{const w=r(y);return{key:w,value:c(v[w]??{},p)}});await l.setItems(M)}))},removeItem:async(o,i)=>{const{driver:n,driverKey:a}=t(o);await I(n,a,i)},removeItems:async o=>{const i={};o.forEach(n=>{let a,l;typeof n=="string"?a=n:"getValue"in n?a=n.key:"item"in n?(a=n.item.key,l=n.options):(a=n.key,l=n.options);const{driverArea:h,driverKey:f}=t(a);i[h]??(i[h]=[]),i[h].push(f),l!=null&&l.removeMeta&&i[h].push(r(f))}),await Promise.all(Object.entries(i).map(async([n,a])=>{await e(n).removeItems(a)}))},removeMeta:async(o,i)=>{const{driver:n,driverKey:a}=t(o);await Z(n,a,i)},snapshot:async(o,i)=>{var l;const a=await e(o).snapshot();return(l=i==null?void 0:i.excludeKeys)==null||l.forEach(h=>{delete a[h],delete a[r(h)]}),a},restoreSnapshot:async(o,i)=>{await e(o).restoreSnapshot(i)},watch:(o,i)=>{const{driver:n,driverKey:a}=t(o);return J(n,a,i)},unwatch(){Object.values(s).forEach(o=>{o.unwatch()})},defineItem:(o,i)=>{const{driver:n,driverKey:a}=t(o),{version:l=1,migrations:h={}}=i??{};if(l<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const f=async()=>{var X;const w=r(a),[{value:x},{value:k}]=await n.getItems([a,w]);if(x==null)return;const V=(k==null?void 0:k.v)??1;if(V>l)throw Error(`Version downgrade detected (v${V} -> v${l}) for "${o}"`);console.debug(`[@wxt-dev/storage] Running storage migration for ${o}: v${V} -> v${l}`);const ge=Array.from({length:l-V},(W,B)=>V+B+1);let A=x;for(const W of ge)try{A=await((X=h==null?void 0:h[W])==null?void 0:X.call(h,A))??A}catch(B){throw Error(`v${W} migration failed for "${o}"`,{cause:B})}await n.setItems([{key:a,value:A},{key:w,value:{...k,v:l}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${o} v${l}`,{migratedValue:A})},v=(i==null?void 0:i.migrations)==null?Promise.resolve():f().catch(w=>{console.error(`[@wxt-dev/storage] Migration failed for ${o}`,w)}),M=new se,y=()=>(i==null?void 0:i.fallback)??(i==null?void 0:i.defaultValue)??null,p=()=>M.runExclusive(async()=>{const w=await n.getItem(a);if(w!=null||(i==null?void 0:i.init)==null)return w;const x=await i.init();return await n.setItem(a,x),x});return v.then(p),{key:o,get defaultValue(){return y()},get fallback(){return y()},getValue:async()=>(await v,i!=null&&i.init?await p():await m(n,a,i)),getMeta:async()=>(await v,await b(n,a)),setValue:async w=>(await v,await E(n,a,w)),setMeta:async w=>(await v,await g(n,a,w)),removeValue:async w=>(await v,await I(n,a,w)),removeMeta:async w=>(await v,await Z(n,a,w)),watch:w=>J(n,a,(x,k)=>w(x??y(),k??y())),migrate:f}}}}function O(s){const e=()=>{if($.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if($.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const r=$.storage[s];if(r==null)throw Error(`"browser.storage.${s}" is undefined`);return r},t=new Set;return{getItem:async r=>(await e().get(r))[r],getItems:async r=>{const c=await e().get(r);return r.map(u=>({key:u,value:c[u]??null}))},setItem:async(r,c)=>{c==null?await e().remove(r):await e().set({[r]:c})},setItems:async r=>{const c=r.reduce((u,{key:d,value:m})=>(u[d]=m,u),{});await e().set(c)},removeItem:async r=>{await e().remove(r)},removeItems:async r=>{await e().remove(r)},snapshot:async()=>await e().get(),restoreSnapshot:async r=>{await e().set(r)},watch(r,c){const u=d=>{const m=d[r];m!=null&&(S(m.newValue,m.oldValue)||c(m.newValue??null,m.oldValue??null))};return e().onChanged.addListener(u),t.add(u),()=>{e().onChanged.removeListener(u),t.delete(u)}},unwatch(){t.forEach(r=>{e().onChanged.removeListener(r)}),t.clear()}}}async function H(){const s=document.createElement("style");s.textContent=`
    @media (max-width: 1200px) {
      .gitingest-text-full {
        display: none !important;
      }
      .gitingest-text-short {
        display: inline !important;
      }
    }
    @media (min-width: 1201px) {
      .gitingest-text-full {
        display: inline !important;
      }
      .gitingest-text-short {
        display: none !important;
      }
    }
  `,document.head.appendChild(s);const e=document.createElement("li"),t=document.createElement("a");t.className="btn-sm btn",t.id="gitingest_btn",t.setAttribute("aria-describedby","gitingest_tooltip");const[r,c]=await Promise.all([F.getItem("sync:baseUrl"),F.getItem("sync:openInNewWindow")]);t.href=window.location.href.replace("github.com",r||"gitingest.com"),c&&(t.target="_blank",t.rel="noopener noreferrer");const u=c?"Turn this to a LLM-friendly prompt in a new tab":"Turn this to a LLM-friendly prompt",d=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" class="octicon octicon-file-moved mr-2"><path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-3.5a.75.75 0 0 1 0-1.5h3.5a.25.25 0 0 0 .25-.25V4.664a.25.25 0 0 0-.073-.177l-2.914-2.914a.25.25 0 0 0-.177-.073H3.75a.25.25 0 0 0-.25.25v6.5a.75.75 0 0 1-1.5 0v-6.5Z"></path><path d="m5.427 15.573 3.146-3.146a.25.25 0 0 0 0-.354L5.427 8.927A.25.25 0 0 0 5 9.104V11.5H.75a.75.75 0 0 0 0 1.5H5v2.396c0 .223.27.335.427.177Z"></path></svg>
    <span class="gitingest-text-full">Open in GitIngest</span>
    <span class="gitingest-text-short">GitIngest</span>
  `;t.innerHTML=d;const m=document.createElement("tool-tip");m.setAttribute("for","gitingest_btn"),m.id="gitingest_tooltip",m.setAttribute("popover","manual"),m.className="position-absolute sr-only",m.setAttribute("role","tooltip"),m.textContent=u;const b=document.createElement("div");return b.className="float-left",b.appendChild(t),b.appendChild(m),e.appendChild(b),e.id="git-ingest-button",e}function oe(s){const e=document.querySelector("#repository-details-container > ul");e&&(e.children.length>=2?e.insertBefore(s,e.children[1]):e.insertBefore(s,e.firstChild))}F.watch("sync:baseUrl",()=>{const s=document.getElementById("git-ingest-button");if(s){const e=s.querySelector("a");e&&H().then(t=>{const r=t.querySelector("a");r&&(e.href=r.href,e.target=r.target,e.rel=r.rel)})}});const ce=(s,e)=>{let t;return function(...r){t||(s.apply(this,r),t=!0,setTimeout(()=>t=!1,e))}};class le{constructor(e){K(this,"observer");K(this,"bodyObserver");K(this,"callback");this.callback=ce(e,250),this.setupObservers(),this.setupNavigationEvents()}setupObservers(){this.observer=new MutationObserver(e=>{for(const t of e)if(t.type==="childList"){this.callback();break}}),this.observeMainContainer(),this.bodyObserver=new MutationObserver(e=>{for(const t of e)t.type==="childList"&&this.observeMainContainer()}),this.bodyObserver.observe(document.body,{childList:!0})}observeMainContainer(){const e=document.querySelector("#js-repo-pjax-container");e&&!this.observer.takeRecords().length&&this.observer.observe(e,{childList:!0,subtree:!0})}setupNavigationEvents(){window.addEventListener("popstate",this.callback),window.addEventListener("pushstate",this.callback),window.addEventListener("replacestate",this.callback)}disconnect(){this.observer.disconnect(),this.bodyObserver.disconnect(),window.removeEventListener("popstate",this.callback),window.removeEventListener("pushstate",this.callback),window.removeEventListener("replacestate",this.callback)}}const ue={matches:["*://*.github.com/*"],main(){const s=()=>window.location.pathname.match(/^\/[^/]+\/[^/]+/);let e=!1;const t=()=>{const r=document.getElementById("git-ingest-button");s()?!r&&!e&&(e=!0,H().then(c=>{oe(c),e=!1}).catch(c=>{console.error(c),e=!1})):r==null||r.remove()};t(),new le(t)}},q=((z=(Q=globalThis.browser)==null?void 0:Q.runtime)==null?void 0:z.id)==null?globalThis.chrome:globalThis.browser;function C(s,...e){}const he={debug:(...s)=>C(console.debug,...s),log:(...s)=>C(console.log,...s),warn:(...s)=>C(console.warn,...s),error:(...s)=>C(console.error,...s)},N=class N extends Event{constructor(e,t){super(N.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}};K(N,"EVENT_NAME",U("wxt:locationchange"));let j=N;function U(s){var e;return`${(e=q==null?void 0:q.runtime)==null?void 0:e.id}:content:${s}`}function de(s){let e,t;return{run(){e==null&&(t=new URL(location.href),e=s.setInterval(()=>{let r=new URL(location.href);r.href!==t.href&&(window.dispatchEvent(new j(r,t)),t=r)},1e3))}}}const L=class L{constructor(e,t){K(this,"isTopFrame",window.self===window.top);K(this,"abortController");K(this,"locationWatcher",de(this));this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return q.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const r=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,t){const r=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const t=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const r=requestIdleCallback((...c)=>{this.signal.aborted||e(...c)},t);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,t,r,c){var u;t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(u=e.addEventListener)==null||u.call(e,t.startsWith("wxt:")?U(t):t,r,{...c,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),he.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:L.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName},"*")}listenForNewerScripts(e){let t=!0;const r=c=>{var u,d;if(((u=c.data)==null?void 0:u.type)===L.SCRIPT_STARTED_MESSAGE_TYPE&&((d=c.data)==null?void 0:d.contentScriptName)===this.contentScriptName){const m=t;if(t=!1,m&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};K(L,"SCRIPT_STARTED_MESSAGE_TYPE",U("wxt:content-script-started"));let R=L;const me=Symbol("null");let fe=0;class ve extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[e]=arguments;if(e!=null){if(typeof e[Symbol.iterator]!="function")throw new TypeError(typeof e+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[t,r]of e)this.set(t,r)}}_getPublicKeys(e,t=!1){if(!Array.isArray(e))throw new TypeError("The keys parameter must be an array");const r=this._getPrivateKey(e,t);let c;return r&&this._publicKeys.has(r)?c=this._publicKeys.get(r):t&&(c=[...e],this._publicKeys.set(r,c)),{privateKey:r,publicKey:c}}_getPrivateKey(e,t=!1){const r=[];for(let c of e){c===null&&(c=me);const u=typeof c=="object"||typeof c=="function"?"_objectHashes":typeof c=="symbol"?"_symbolHashes":!1;if(!u)r.push(c);else if(this[u].has(c))r.push(this[u].get(c));else if(t){const d=`@@mkm-ref-${fe++}@@`;this[u].set(c,d),r.push(d)}else return!1}return JSON.stringify(r)}set(e,t){const{publicKey:r}=this._getPublicKeys(e,!0);return super.set(r,t)}get(e){const{publicKey:t}=this._getPublicKeys(e);return super.get(t)}has(e){const{publicKey:t}=this._getPublicKeys(e);return super.has(t)}delete(e){const{publicKey:t,privateKey:r}=this._getPublicKeys(e);return!!(t&&super.delete(t)&&this._publicKeys.delete(r))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new ve;function be(){}function P(s,...e){}const we={debug:(...s)=>P(console.debug,...s),log:(...s)=>P(console.log,...s),warn:(...s)=>P(console.warn,...s),error:(...s)=>P(console.error,...s)};return(async()=>{try{const{main:s,...e}=ue,t=new R("content",e);return await s(t)}catch(s){throw we.error('The content script "content" crashed on startup!',s),s}})()}();
content;
